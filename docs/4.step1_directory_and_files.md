# Step 1: Directory and File Structure Creation

**Objective:** Create the complete project folder and file structure for SearchFlow.

This step will guide you through creating all necessary directories and initializing files that define the project architecture.

---

## ðŸŽ¯ What You Will Learn

- How to organize a Python project structure
- Why each folder exists and what goes inside
- How to create placeholder files for future development
- Best practices for project scaffolding

---

## ðŸ“‹ Complete Directory Structure

```
SearchFlow/
â”‚
â”œâ”€â”€ app/                          # Main application code
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                   # FastAPI entry point
â”‚   â”œâ”€â”€ api/                      # API routes
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ search.py             # /search endpoint
â”‚   â”œâ”€â”€ mcp/                      # MCP server & tools
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ search_tool.py        # Search tool interface
â”‚   â”œâ”€â”€ search/                   # Search integrations
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ searxng_client.py     # SearXNG HTTP client
â”‚   â”œâ”€â”€ ai/                       # AI & reasoning logic
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ dspy_pipeline.py      # DSPy reasoning pipeline
â”‚   â”œâ”€â”€ schemas/                  # Pydantic data models
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ search.py             # Search request/response schemas
â”‚   â”œâ”€â”€ core/                     # Core utilities & config
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py             # Environment variables
â”‚   â”‚   â””â”€â”€ logging.py            # Logging setup
â”‚   â””â”€â”€ utils/                    # Helper functions
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ text.py               # Text cleanup utilities
â”‚
â”œâ”€â”€ tests/                        # Test suite
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_health.py            # API health tests
â”‚   â”œâ”€â”€ test_search_api.py        # /search endpoint tests
â”‚   â””â”€â”€ test_e2e.py               # End-to-end tests
â”‚
â”œâ”€â”€ docker/                       # Docker configuration
â”‚   â”œâ”€â”€ Dockerfile.api            # FastAPI container
â”‚   â””â”€â”€ Dockerfile.searxng        # SearXNG container (optional)
â”‚
â”œâ”€â”€ docs/                         # Documentation
â”‚   â”œâ”€â”€ 1.project_explained.md
â”‚   â”œâ”€â”€ 2.tech_stack.md
â”‚   â”œâ”€â”€ 3.project_structure.md
â”‚   â”œâ”€â”€ 4.step1_directory_and_files.md
â”‚   â”œâ”€â”€ 5.step2_uv_setup.md
â”‚   â”œâ”€â”€ 6.step3_docker_setup.md
â”‚   â”œâ”€â”€ 7.step4_cicd_basics.md
â”‚   â””â”€â”€ 8.step5_fastapi_implementation.md
â”‚
â”œâ”€â”€ .env                          # Environment variables (not in git)
â”œâ”€â”€ .env.example                  # Example environment file
â”œâ”€â”€ .gitignore                    # Git ignore rules
â”œâ”€â”€ docker-compose.yml            # Multi-service setup
â”œâ”€â”€ pyproject.toml                # Project metadata
â”œâ”€â”€ requirements.txt              # Python dependencies (updated by uv)
â”œâ”€â”€ uv.lock                       # Dependency lock file (auto-generated)
â”œâ”€â”€ README.md                     # Project overview
â””â”€â”€ QWEN.md                       # Project context

```

---

## ðŸ› ï¸ Step-by-Step Creation

### Step 1.1: Create Main Application Directory Structure

Run these commands from your project root:

```bash
# Create app directory and subdirectories
mkdir -p app/{api,mcp,search,ai,schemas,core,utils}

# Create tests directory
mkdir -p tests

# Create docker configuration directory
mkdir -p docker
```

### Step 1.2: Initialize Python Packages

Create `__init__.py` files to make directories Python packages:

```bash
# Main app package
touch app/__init__.py

# Sub-packages in app
touch app/api/__init__.py
touch app/mcp/__init__.py
touch app/search/__init__.py
touch app/ai/__init__.py
touch app/schemas/__init__.py
touch app/core/__init__.py
touch app/utils/__init__.py

# Test package
touch tests/__init__.py
```

### Step 1.3: Create Core Application Files

```bash
# Main entry point
touch app/main.py

# API routes
touch app/api/search.py

# MCP tools
touch app/mcp/search_tool.py

# Search integration
touch app/search/searxng_client.py

# AI reasoning
touch app/ai/dspy_pipeline.py

# Data schemas
touch app/schemas/search.py

# Core utilities
touch app/core/config.py
touch app/core/logging.py

# Helper functions
touch app/utils/text.py
```

### Step 1.4: Create Test Files

```bash
touch tests/test_health.py
touch tests/test_search_api.py
touch tests/test_e2e.py
```

### Step 1.5: Create Docker Files

```bash
touch docker/Dockerfile.api
touch docker/Dockerfile.searxng
```

### Step 1.6: Create Configuration Files

```bash
# Environment files
touch .env
touch .env.example

# Docker Compose
touch docker-compose.yml

# Git ignore
touch .gitignore
```

---

## ðŸ“ File Templates with Explanations

### app/**init**.py

```python
"""
SearchFlow Application Package

This package contains the main application logic for SearchFlow.
"""

__version__ = "0.1.0"
__author__ = "Ayush Raj"
```

**Why:** Marks the directory as a Python package and defines version info.

---

### app/main.py

```python
"""
FastAPI Application Entry Point

This is the main entry point for the SearchFlow application.
It initializes FastAPI and configures all routes and middleware.
"""

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.config import settings
from app.core.logging import setup_logging

# Initialize logging
setup_logging()

# Create FastAPI app
app = FastAPI(
    title="SearchFlow",
    description="AI-powered search backend that returns structured knowledge",
    version="0.1.0",
)

# Add CORS middleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.ALLOWED_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.get("/")
async def root():
    """Health check endpoint"""
    return {"message": "SearchFlow is running"}

@app.get("/health")
async def health():
    """Detailed health check"""
    return {
        "status": "healthy",
        "version": "0.1.0",
        "service": "SearchFlow API"
    }

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8007)
```

**Why:** This is where FastAPI is initialized. It defines the root application object that all routes attach to.

---

### app/api/search.py

```python
"""
Search API Routes

This module defines all search-related API endpoints.
"""

from fastapi import APIRouter, HTTPException
from pydantic import BaseModel

router = APIRouter(prefix="/api", tags=["search"])

class SearchRequest(BaseModel):
    """Request model for search endpoint"""
    query: str
    limit: int = 10

class SearchResponse(BaseModel):
    """Response model for search endpoint"""
    query: str
    results: list
    markdown: str
    json_output: dict

@router.post("/search", response_model=SearchResponse)
async def search(request: SearchRequest):
    """
    Execute a search query and return structured results

    - **query**: The search query string
    - **limit**: Maximum number of results
    """
    # Placeholder - will be implemented in Step 5
    return {
        "query": request.query,
        "results": [],
        "markdown": "# Search Results\n\nResults will appear here",
        "json_output": {"status": "placeholder"}
    }
```

**Why:** Defines the API endpoint structure with request/response validation using Pydantic.

---

### app/core/config.py

```python
"""
Configuration Management

This module manages all application configuration from environment variables.
"""

from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    """Application settings loaded from environment variables"""

    # API Configuration
    API_TITLE: str = "SearchFlow"
    API_VERSION: str = "0.1.0"
    DEBUG: bool = False

    # CORS Configuration
    ALLOWED_ORIGINS: list = ["http://localhost", "http://localhost:3000"]

    # Search Configuration
    SEARXNG_URL: str = "http://localhost:8888"

    # Logging Configuration
    LOG_LEVEL: str = "INFO"

    class Config:
        env_file = ".env"

# Create settings instance
settings = Settings()
```

**Why:** Centralizes all configuration in one place, making it easy to manage different environments (dev, test, prod).

---

### app/core/logging.py

```python
"""
Logging Configuration

This module sets up structured logging for the application.
"""

import logging
import sys
from app.core.config import settings

def setup_logging():
    """Configure application logging"""

    # Create logger
    logger = logging.getLogger("searchflow")
    logger.setLevel(settings.LOG_LEVEL)

    # Console handler
    handler = logging.StreamHandler(sys.stdout)
    handler.setLevel(settings.LOG_LEVEL)

    # Formatter
    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    handler.setFormatter(formatter)

    # Add handler to logger
    logger.addHandler(handler)

    return logger
```

**Why:** Provides consistent, structured logging across the entire application.

---

### app/utils/text.py

```python
"""
Text Utility Functions

This module provides helper functions for text processing.
"""

def clean_text(text: str) -> str:
    """Remove extra whitespace and normalize text"""
    return " ".join(text.split())

def truncate_text(text: str, max_length: int = 100) -> str:
    """Truncate text to a maximum length"""
    if len(text) <= max_length:
        return text
    return text[:max_length] + "..."
```

**Why:** Provides reusable utility functions to keep code DRY (Don't Repeat Yourself).

---

### app/schemas/search.py

```python
"""
Pydantic Data Models

This module defines request/response schemas for API endpoints.
"""

from pydantic import BaseModel
from typing import Optional, List

class SearchRequestSchema(BaseModel):
    """Schema for search API request"""
    query: str
    limit: Optional[int] = 10

    class Config:
        json_schema_extra = {
            "example": {
                "query": "Best FastAPI practices",
                "limit": 10
            }
        }

class SearchResultSchema(BaseModel):
    """Schema for individual search result"""
    title: str
    url: str
    snippet: str

class SearchResponseSchema(BaseModel):
    """Schema for search API response"""
    query: str
    results: List[SearchResultSchema]
    markdown_summary: str
    json_data: dict
```

**Why:** Defines strict data validation for API requests and responses, preventing bugs and improving API documentation.

---

### tests/test_health.py

```python
"""
Health Check Tests

Tests for API health endpoints.
"""

import pytest
from fastapi.testclient import TestClient
from app.main import app

client = TestClient(app)

def test_root_endpoint():
    """Test root endpoint returns success"""
    response = client.get("/")
    assert response.status_code == 200
    assert response.json()["message"] == "SearchFlow is running"

def test_health_endpoint():
    """Test health endpoint returns healthy status"""
    response = client.get("/health")
    assert response.status_code == 200
    assert response.json()["status"] == "healthy"
```

**Why:** Ensures basic API functionality works correctly before running complex tests.

---

### .env.example

```env
# FastAPI Configuration
DEBUG=false
LOG_LEVEL=INFO

# SearXNG Configuration
SEARXNG_URL=http://localhost:8888

# CORS Configuration
ALLOWED_ORIGINS=http://localhost,http://localhost:3000,http://localhost:8007
```

**Why:** Shows what environment variables are needed. Users copy this to `.env` and fill in their values.

---

### .gitignore

```
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
env/
venv/
ENV/
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# Virtual environments
.venv/
venv/

# IDEs
.vscode/
.idea/
*.swp
*.swo
*~

# Environment variables
.env
.env.local

# Pytest
.pytest_cache/
htmlcov/

# Mypy
.mypy_cache/
.dmypy.json
dmypy.json

# Coverage
.coverage
htmlcov/

# Docker
docker-compose.override.yml

# Lock files (generated)
uv.lock
```

**Why:** Prevents accidentally committing sensitive or auto-generated files to version control.

---

### docker/Dockerfile.api

```dockerfile
FROM python:3.12-slim

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements
COPY requirements.txt .

# Install Python dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy application
COPY . .

# Run application
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8007"]
```

**Why:** Defines how to build a Docker image for the API. Uses Python 3.12 slim image for small size.

---

### docker-compose.yml

```yaml
version: "3.8"

services:
  api:
    build:
      context: .
      dockerfile: docker/Dockerfile.api
    ports:
      - "8007:8007"
    environment:
      - DEBUG=false
      - LOG_LEVEL=INFO
      - SEARXNG_URL=http://searxng:8888
    depends_on:
      - searxng
    volumes:
      - .:/app
    command: uvicorn app.main:app --host 0.0.0.0 --port 8007 --reload

  searxng:
    image: searxng/searxng:latest
    ports:
      - "8888:8888"
    environment:
      - SEARXNG_SECRET=your_secret_key_here
    volumes:
      - searxng-data:/data
    command: start

volumes:
  searxng-data:
```

**Why:** Defines how to run multiple services (API + SearXNG) together locally with proper networking.

---

### pyproject.toml

```toml
[project]
name = "searchflow"
version = "0.1.0"
description = "Self-hosted AI-powered search backend that returns structured knowledge"
readme = "README.md"
requires-python = ">=3.12"
authors = [
    { name = "Ayush Raj", email = "ayush@example.com" },
]

dependencies = [
    "fastapi>=0.104.0",
    "uvicorn[standard]>=0.24.0",
    "pydantic>=2.0.0",
    "pydantic-settings>=2.0.0",
    "httpx>=0.25.0",
    "pytest>=7.4.0",
    "pytest-asyncio>=0.21.0",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.pytest.ini_options]
asyncio_mode = "auto"
testpaths = ["tests"]
python_files = "test_*.py"
```

**Why:** Defines project metadata, dependencies, and tool configurations in a standardized format.

---

## âœ… Verification Checklist

After creating all files and folders, verify everything is in place:

```bash
# Check directory structure
tree -I '__pycache__|*.pyc' app tests docker docs

# Check all __init__.py files exist
find . -type d -name app -o -name tests | xargs -I {} find {} -name __init__.py

# Verify all files are created
ls -la app/
ls -la app/api/
ls -la app/core/
ls -la tests/
ls -la docker/
```

Expected output should show all directories and files as described above.

---

## ðŸŽ“ Key Concepts You've Learned

1. **Project Structure** - How Python projects are organized into packages and modules
2. **Package Initialization** - Why `__init__.py` files are important
3. **Separation of Concerns** - Why code is divided into api/, core/, schemas/, etc.
4. **Configuration Management** - Centralizing settings for different environments
5. **Docker Setup** - How containerization is configured at the start
6. **Documentation** - Setting up docs folder for learning journey

---

## ðŸ”— Next Steps

Once you've created all directories and files, proceed to **Step 2: Dependency Management with uv**.

In Step 2, you will:

- Install the `uv` package manager
- Set up a virtual environment
- Install all Python dependencies
- Lock dependencies for reproducibility

---

## ðŸ’¡ Tips

- **Verify each step**: After creating folders, run `ls -la` to confirm
- **Keep backups**: Before major changes, backup your directory
- **Use templates**: These templates can be reused for future projects
- **Understand structure**: Read through each file to understand its purpose

---
